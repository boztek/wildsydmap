<!DOCTYPE html>
<html>
<head>
    <title>Wild Sydney Map</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0;
            padding: 0
        }

        #map-canvas {
            height: 100%
        }
    </style>
    <script src="js/jquery-1.10.2.js"></script>
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXWYSYuzbLCbBf7ulR43jd4ZgXuycuk4Y&sensor=true">
    </script>
    <script type="text/javascript">
        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng(-34.397, 150.644),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"),
                    mapOptions);


            return map;
        }
//        google.maps.event.addDomListener(window, 'load', initialize);

        var instagram_end = 'https://api.instagram.com/v1/tags/wildsydney/media/recent?access_token=';

        jQuery(function () {
            var map = initialize();

            var access_token = window.location.href.split('#')[1].split('=')[1];
            var ig_api = instagram_end + access_token;
            console.log(ig_api);

            var tag = "wildsydney";
            var count = 4;
            var access_parameters = {access_token: access_token};

            function grabImages(access_parameters) {

                jQuery.ajax({
                    type: "GET",
                    dataType: "jsonp",
                    cache: false,
                    url: ig_api,
                    success: function (data) {

                        console.log(data);
                        var add_marker = function (id, point, note) {
                            var info_window = new google.maps.InfoWindow({content: ''});

                            function add_marker(racer_id, point, note) {
                                var marker = new google.maps.Marker({map: map, position: point, clickable: true});
                                marker.note = note;
                                google.maps.event.addListener(marker, 'click', function () {
                                    info_window.content = marker.note;
                                    info_window.open(map, marker);
                                });
                                return marker;
                            }
                        }

                        for (var i = 0; i < data.data.length; ++i) {
                            var image = data.data[i].images.thumbnail.url;
                            var full_image = data.data[i].images.standard_resolution.url;

                            if (data.data[i].location === null) {
                                continue;
                            }
                            var lat = data.data[i].location.latitude;
                            var lon = data.data[i].location.longitude;

                            var myLatlng = new google.maps.LatLng(lat, lon);
                            var icon_size = new google.maps.Size(50, 50);
                            var icon = {
                                scaledSize: icon_size,
                                url: image
                            };
                            console.log(image);
                            var marker = new google.maps.Marker({
                                position: myLatlng,
                                map: map,
                                title: "Hello World!",
                                icon: icon
                            });
                            marker.info = new google.maps.InfoWindow({
                                content: '<img width=300 src="' +image+ '" />',
                            });
                            google.maps.event.addListener(marker, 'click', function () {
                                this.info.open(map, this);
                            });
                        }

                    }
                });
            }

            function onDataLoaded(instagram_data) {

                if (instagram_data.meta.code == 200) {

                    var photos = instagram_data.data;

                    if (photos.length > 0) {

                        for (var key in photos) {
                            var photo = photos[key];
                            $('#target').append('<img src =' + photo.images.thumbnail.url + '">');
                        }
                    } else {

                        $("#target").append("Hmmm. I couldn't find anything!");
                    }
                } else {

                    var error = data.meta.error_message;
                    $("#target").append('Something happened, Instagram said:' + error);

                }

            }


            grabImages(access_parameters);
        });

    </script>
</head>
<body>
    <h1>Wild Sydney</h1>
    <div>
        <a
                href="https://instagram.com/oauth/authorize/?client_id=2263f091c81742ceb20d2d3ee57197a0&redirect_uri=http://wildsyd.dev:9999&response_type=token">
            Login with Instagram
        </a>
    </div>

    <div id="map-canvas"/>
</body>
</html>